/* Generated by osLET IDE */

#include "../syscall.h"
#include "../lib/stdio.h"

// Controls for Form1
gui_control_t Form1_controls[] = {
    {CTRL_PICTUREBOX, 5, 5, 108, 208, 0, 7, "SETUP.BMP", 1, 0, 12, 0, 0, NULL, 0},
    {CTRL_BUTTON, 295, 191, 70, 23, 0, 7, "OK", 2, 0, 12, 0, 0, NULL, 0},
    {CTRL_LABEL, 118, 12, 0, 0, 0, 15, "Welcome to osLET!", 3, 1, 12, 0, 0, NULL, 0},
    {CTRL_LABEL, 119, 40, 219, 114, 0, 15, "This window serves as a test of the\ncontrol system in osLET graphical\nuser interface.\n\nYou can drag this window freely using\nthe mouse, or click the button below\nto exit back to shell.", 5, 0, 12, 0, 0, NULL, 0}
};

void* create_Form1(void) {
    void *form = sys_win_create_form("Welcome screen", 50, 50, 370, 240);
    for (int i = 0; i < 4; i++) {
        sys_win_add_control(form, &Form1_controls[i]);
    }
    sys_win_draw(form);
    return form;
}

void draw_taskbar(void) {
    sys_gfx_fillrect(1, 480-25, 638, 24, COLOR_LIGHT_GRAY);
    sys_gfx_line(0, 480-26, 639, 480-26, COLOR_WHITE);
    sys_gfx_line(0, 480-25, 0, 478, COLOR_WHITE);
    sys_gfx_line(639, 480-25, 639, 479, COLOR_DARK_GRAY);
    sys_gfx_line(0, 479, 639, 479, COLOR_DARK_GRAY);
}

__attribute__((section(".entry"), used))
void _start(void) {
    int mx = 320;
    int my = 240;
    unsigned char mb;

    sys_gfx_enter();
    sys_gfx_fillrect(0, 0, 640, 480, COLOR_CYAN);
    draw_taskbar();

    // Create windows
    void *Form1 = create_Form1();

    int exit_requested = 0;

    while (!exit_requested) {
        sys_get_mouse_state(&mx, &my, &mb);

        // Handle Form1 events
        int event0 = sys_win_pump_events(Form1);
        if (event0 > 0) {
            /* Control clicked in Form1 - event = control ID */
            if (event0 == 2) { /* OK */
                exit_requested = 1;
            }
        } else if (event0 == -2 || event0 == -1) {
            sys_win_redraw_all();
        }

        sys_mouse_draw_cursor(mx, my, 0);
        sys_gfx_swap();
    }

    sys_win_destroy_form(Form1);
    sys_gfx_exit();
    sys_exit();
}
